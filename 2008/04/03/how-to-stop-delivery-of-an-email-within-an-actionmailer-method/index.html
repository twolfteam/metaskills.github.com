<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="author" content="Ken Collins">
    <title>
      How To Stop Delivery Of An Email Within An ActionMailer Method @MetaSkills.net
    </title>
    <link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/metaskills" title="MetaSkills.net">
    <link rel="author" href="mailto:ken@metaskills.net">
    <link rel="stylesheet" href="/resource/reset.css" type="text/css">
    <link rel="stylesheet" href="/resource/site.css" type="text/css">
    <link rel="shortcut icon" href="/favicon.png">
    <script src="/resource/zepto.js" type="text/javascript">
</script>
    <script src="/resource/site.js" type="text/javascript">
</script>
  </head>
  <body>
    <header id="mast">
      <div class="content">
        <section id="identity">
          <div id="avatar"></div>
          <div>
            MetaSkills.net
          </div>
          <div>
            Coding things under other things!
          </div>
        </section>
        <nav>
          <ul>
            <li>
              <a href="/" class="button" data-icon="H">Home</a>
            </li>
            <li>
              <a href="/pages/colophon.html" class="button" data-icon="i">Colophon</a>
            </li>
            <li>
              <a href="/pages/projects.html" class="button" data-icon="x">Projects</a>
            </li>
            <li>
              <a href="http://twitter.com/metaskills" class="button" data-icon="B">Follow</a>
            </li>
          </ul>
        </nav>
      </div>
    </header>
    <section id="page">
      <section id="content">
        <article id="post">
          <header>
            <time pubdate datetime="2008-04-03T00:00:00-04:00">
              <span class="day">03</span> <span class="month">Apr</span> <span class="year">2008</span>
            </time>
            <h1>
              How To Stop Delivery Of An Email Within An ActionMailer Method
            </h1>
          </header>
          <p>
            OK, so you want to keep your code placement REALLY organized. You have <a href="/2008/03/26/don-t-be-a-plinko-programmer/">read about my
            persnicketyness</a> and now you want to practice the best in concern placement and keep those controllers of yours really slim. Like me,
            you may want to try and keep controller feature additions to very specific one liners of code. Organizing your controller code to do just
            that with ActiveRecord models or even your own custom classes is a pretty easy task, but how do you keep things simple when dealing with
            controller actions that have to send email AND you want that single email link of code to be responsible for everything in it's own
            encapsulated way.
          </p>
          <p>
            The answer is to push the logic back to the model again. Your controllers should not be concerned with the logic that deals with your own
            business rules for sending email. The problem with ActionMailer is that most people just use the dynamic
            <code>MyMailerClass.deliver_</code> methods that utilize <code>method_missing</code> to instantiate a mailer classs, and send an email in
            one fell swoop. I like this usage too, but the challenge is how to tell an instance of a the ActionMailer::Base class that it needs to
            stop delivery within a method definition that is all set to deliver? The answer is Ruby singleton method magic.
          </p>
          <div class="highlight">
            <pre>
<code class="ruby"><span class="k">module</span> <span class="nn">ActionMailer</span>
  <span class="k">class</span> <span class="nc">Base</span>
    
    <span class="c1"># A simple way to short circuit the delivery of an email from within</span>
    <span class="c1"># deliver_* methods defined in ActionMailer::Base subclases.</span>
    <span class="k">def</span> <span class="nf">do_not_deliver!</span>
      <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">deliver!</span> <span class=
"p">;</span> <span class="kp">false</span> <span class="p">;</span> <span class="k">end</span>
    <span class="k">end</span>
    
  <span class="k">end</span>
<span class="k">end</span>
</code>
</pre>
          </div>
          <p>
            I suggest placing this code into your <code>lib/core_ext/action_mailer.rb</code> file. It will allow you to write mailer methods that can
            short circuit themselves to stop delivery. For instance:
          </p>
          <div class="highlight">
            <pre>
<code class="ruby"><span class="k">class</span> <span class="nc">MyMailerClass</span> <span class="o">&lt;</span> <span class=
"no">ActionMailer</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">def</span> <span class="nf">user_notification</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="c1"># ... </span>
    <span class="n">do_not_deliver!</span> <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class=
"n">email</span><span class="o">.</span><span class="n">blank?</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="c1"># In your controller code.</span>
<span class="no">MyMailerClass</span><span class="o">.</span><span class="n">deliver_user_notification</span><span class="p">(</span><span class=
"vi">@user</span><span class="p">)</span>
</code>
</pre>
          </div>
          <p>
            Now you do not have to worry about placing delivery concerns in the controller and even worse duplicate that code when you have to use
            the same mailer method in multiple places. This works by letting the instance of the ActionMailer::Base class define it's own deliver!
            method which trumps the delier! method called by that object normally defined in ActionMailer::Base.
          </p>
          <h2>
            Resources
          </h2>
          <ul>
            <li>
              <a href="http://www.ruby-doc.org/docs/UsersGuide/rg/singletonmethods.html">About Singleton Methods</a>
            </li>
            <li>
              <a href="http://redhanded.hobix.com/inspect/methodsThatSelfDestruct.html">Methods That Self-Destruct</a>
            </li>
          </ul>
          <footer id="disqus_thread">
            <script type="text/javascript">
var disqus_shortname = 'metaskillsnet';
            var disqus_identifier = '/2008/04/03/how-to-stop-delivery-of-an-email-within-an-actionmailer-method/';
            var disqus_title = 'How To Stop Delivery Of An Email Within An ActionMailer Method';
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
            </script>
          </footer>
        </article>
      </section>
      <nav>
        <div>
          <a href="http://www.youtube.com/watch?v=8pBTK-pdMP0">Society for coding things on top of other things!</a>
        </div>
        <h3>
          Categories
        </h3>
        <ul>
          <li>
            <a href="/categories/heuristics.html">Heuristics</a>
          </li>
          <li>
            <a href="/categories/workflow.html">Workflow</a>
          </li>
          <li>
            <a href="/categories/apple-os.html">Apple/OS</a>
          </li>
          <li>
            <a href="/categories/database.html">Database</a>
          </li>
          <li>
            <a href="/categories/lifestyle.html">Lifestyle</a>
          </li>
          <li>
            <a href="/categories/miscellaneous.html">Miscellaneous</a>
          </li>
          <li>
            <a href="/categories/ruby-rails.html">Ruby/Rails</a>
          </li>
          <li>
            <a href="/categories/javascript.html">JavaScript</a>
          </li>
          <li>
            <a href="/categories/tools.html">Tools</a>
          </li>
        </ul>
      </nav>
    </section>
    <footer id="foot">
      <section id="footer">
        <section id="recentposts">
          <h3>
            Recent Posts
          </h3>
          <article>
            <h4>
              Use Compass Sass Framework Files With The Rails 3.1.0.rc5 Asset Pipeline
            </h4>
            <p>
              <a href="/2011/07/29/use-compass-sass-framework-files-with-the-rails-3.1.0.rc5-asset-pipeline">This is a simple update to my original
              article for using compass's .scss files with the asset pipeline. This assumes you had this setup working in Rails 3.1.0.rc4, but
              should...</a>
            </p>
          </article>
          <article>
            <h4>
              Free The Enterprise With Ruby & Master Your Own Domain
            </h4>
            <p>
              <a href="/2011/07/01/free-the-enterprise-with-ruby-and-master-your-own-domain">For anyone that did not attend the first MADExpo
              (Mid-Atlantic Developer Expo) this week, here are my slides posted on slideshare. This talk centers around 3 basic sections. The
              first...</a>
            </p>
          </article>
          <article>
            <h4>
              Bind jQuery Event Handlers To This Object With CoffeeScript
            </h4>
            <p>
              <a href="/2011/05/22/bind-jquery-event-handlers-to-this-object-with-coffeescript">Friends have told me that rich domain objects are
              seldom wielded when using jQuery to enhance behavior on web pages. I myself have always loved JavaScript as a rich dynamic...</a>
            </p>
          </article>
          <aside id="powered">
            <span>Powered by <a href="http://github.com/henrik/jekyll">Jekyll</a> and <a href="http://disqus.com">Disqus</a>. Check out <a href=
            "https://github.com/metaskills/metaskills.net">the code</a>.</span><br>
            <span>&copy; 2006-2011 Ken Collins. All rights reserved.</span>
          </aside>
          <aside id="html5_badge">
            <a href="http://www.w3.org/html/logo/"></a>
          </aside>
        </section>
        <section id="badges">
          <ul>
            <li>
              <a id="badge_js" href="https://developer.mozilla.org/en/JavaScript" title='JavaScript'>JavaScript</a>
            </li>
            <li>
              <a id="badge_ios" href="http://developer.apple.com/"></a>
            </li>
            <li>
              <a id="badge_railscore" href="http://contributors.rubyonrails.org/contributors/ken-collins/commits"></a>
            </li>
            <li>
              <a id="badge_pragalumni" href="http://alumni.pragmaticstudio.com/users/128"></a>
            </li>
            <li>
              <a id="badge_linkedin" href="http://www.linkedin.com/in/metaskills"></a>
            </li>
            <li>
              <a id="badge_slideshare" href="http://www.slideshare.net/metaskills"></a>
            </li>
            <li>
              <a id="badge_757rb" href="http://757rb.org/"></a>
            </li>
          </ul>
        </section>
        <section id="blogroll">
          <h3>
            Blogroll
          </h3>
          <ul>
            <li>
              <a href="http://ryan.mcgeary.org/">Ryan McGeary</a>
            </li>
            <li>
              <a href="http://www.linkedin.com/in/imbriaco">Mark Imbriaco</a>
            </li>
            <li>
              <a href="http://mwhuss.com/">Marshall Huss</a>
            </li>
            <li>
              <a href="http://fun3d.larc.nasa.gov/">Bil Kleb</a>
            </li>
            <li>
              <a href="http://www.buzzwordcompliant.net/">Mike Buckbee</a>
            </li>
            <li>
              <a href="http://www.candescence.org/">Geoff Parsons</a>
            </li>
            <li>
              <a href="http://www.wearetitans.net/">Brennan Dunn</a>
            </li>
            <li>
              <a href="http://evan.tiggerpalace.com/">Evan Light</a>
            </li>
            <li>
              <a href="http://techiferous.com/">Wyatt Greene</a>
            </li>
            <li>
              <a href="http://www.engineyard.com/blog/author/wayneseguin/">Wayne E. Sequin</a>
            </li>
          </ul>
        </section>
      </section>
    </footer>
  </body>
</html>
